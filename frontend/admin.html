<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brechtwahl · Admin</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body data-page="admin">
  <div class="container">
    <header class="header">
      <a href="./index.html" class="brand">
        <div class="brand__badge">BW</div>
        <div class="brand__text">
          <div class="brand__title">Brechtwahl</div>
          <div class="brand__subtitle">Admin-Bereich</div>
        </div>
      </a>
      <nav class="nav">
        <a href="./polls.html">Alle Abstimmungen</a>
        <a href="#" data-logout>Abmelden</a>
      </nav>
    </header>

    <section class="card card--highlight">
      <h2>Neue Abstimmung erstellen</h2>
      <form data-admin-form>
        <div class="form-group">
          <label class="form-label" for="title">Titel</label>
          <input 
            class="input" 
            type="text" 
            id="title"
            placeholder="Kurzer, prägnanter Titel" 
            data-admin-title 
            required 
          />
        </div>
        <div class="form-group">
          <label class="form-label" for="question">Abstimmungsfrage</label>
          <input 
            class="input" 
            type="text" 
            id="question"
            placeholder="Die Frage, über die abgestimmt wird" 
            data-admin-question 
            required 
          />
        </div>
        <button class="button" type="submit">Abstimmung erstellen</button>
      </form>
    </section>

    <h2 class="mt-4 mb-3">Bestehende Abstimmungen</h2>
    <section class="grid" data-admin-list></section>

    <section class="card card--soft" id="test-vote-card">
      <h3>Test-Abstimmung (Status)</h3>
      <p>Übersicht über die Test-Abstimmung. Zum Abstimmen öffne <a href="./test_abstimmung.html" target="_blank" rel="noopener">test_abstimmung.html</a>.</p>
      <div id="test-results">
        <strong>Ergebnisse:</strong>
        <div id="test-counts">Lade...</div>
        <div id="test-winner"></div>
      </div>
    </section>

    <footer class="footer">
      Brechtwahl · Demokratieprojekt der Brecht Schule Hamburg
    </footer>
  </div>

  <script src="./app.js"></script>

  <script>
    const TEST_API = '/api/test';

    async function updateTestResults() {
      try {
        const res = await fetch(`${TEST_API}/votes`);
        const data = await res.json();
        document.getElementById('test-counts').textContent = `Ja: ${data.yes} · Nein: ${data.no} · Gesamt: ${data.total}`;
        const winner = data.yes > data.no ? 'Ja liegt vorne' : (data.no > data.yes ? 'Nein liegt vorne' : 'Unentschieden');
        document.getElementById('test-winner').textContent = winner;
      } catch (e) {
        document.getElementById('test-counts').textContent = 'Fehler beim Laden';
      }
    }

    updateTestResults();
    setInterval(updateTestResults, 3000);
  </script>
</body>
</html>
