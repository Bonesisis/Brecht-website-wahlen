<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test-Abstimmung 路 Brechtwahl</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body data-page="test-abstimmung">
  <div class="container">
    <header class="header">
      <a href="./index.html" class="brand">
        <div class="brand__badge">BW</div>
        <div class="brand__text">
          <div class="brand__title">Brechtwahl</div>
          <div class="brand__subtitle">Test-Abstimmung</div>
        </div>
      </a>
      <nav class="nav">
        <a href="./admin.html">Admin</a>
        <a href="./polls.html">Alle Abstimmungen</a>
      </nav>
    </header>

    <section class="card card--highlight">
      <h2>so wie isses</h2>
      <p>Hier kannst du Test-Stimmen abgeben (ohne Anmeldung).</p>
      <div id="test-buttons" class="mb-2">
        <button id="test-yes" class="button">Ja</button>
        <button id="test-no" class="button button--outline">Nein</button>
      </div>
      <div id="test-results">
        <strong>Ergebnisse:</strong>
        <div id="test-counts">Lade...</div>
        <div id="test-winner"></div>
      </div>
    </section>

    <footer class="footer">
      Brechtwahl 路 Demokratieprojekt der Brecht Schule Hamburg
    </footer>
  </div>

  <script src="./app.js"></script>
  <script>
    const TEST_API = '/api/test';

    async function updateTestResults() {
      try {
        const res = await fetch(`${TEST_API}/votes`);
        const data = await res.json();
        document.getElementById('test-counts').textContent = `Ja: ${data.yes} 路 Nein: ${data.no} 路 Gesamt: ${data.total}`;
        const winner = data.yes > data.no ? 'Ja liegt vorne' : (data.no > data.yes ? 'Nein liegt vorne' : 'Unentschieden');
        document.getElementById('test-winner').textContent = winner;
      } catch (e) {
        document.getElementById('test-counts').textContent = 'Fehler beim Laden';
      }
    }

    async function postTestVote(choice) {
      try {
        await fetch(`${TEST_API}/vote`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ choice })
        });
        updateTestResults();
      } catch (e) {
        alert('Fehler beim Senden der Stimme');
      }
    }

    document.getElementById('test-yes').addEventListener('click', () => postTestVote('yes'));
    document.getElementById('test-no').addEventListener('click', () => postTestVote('no'));

    updateTestResults();
    setInterval(updateTestResults, 3000);
  </script>
</body>
</html>
